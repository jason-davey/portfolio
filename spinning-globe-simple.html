<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spinning Illustrated Globe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow: hidden;
        }

        #globe-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #globe-canvas {
            width: 80vmin;
            height: 80vmin;
            max-width: 600px;
            max-height: 600px;
        }

        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            color: #333;
        }

        .info h3 {
            margin: 0 0 5px 0;
            color: #6b8e6b;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #6b8e6b;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .info {
                top: 10px;
                left: 10px;
                right: 10px;
                font-size: 12px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div id="globe-container">
        <div id="globe-canvas"></div>
        <div class="info">
            <h3>Illustrated Spinning Globe</h3>
            <p>Three.js implementation with custom vector-style world map</p>
        </div>
        <div class="loading" id="loading">Loading globe...</div>
    </div>

    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script>
        class SpinningGlobe {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.globe = null;
                this.animationId = null;

                this.init();
                this.animate();
                this.setupResize();
            }

            init() {
                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xffffff);

                // Camera setup
                const aspect = this.container.clientWidth / this.container.clientHeight;
                this.camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
                this.camera.position.z = 3;

                // Renderer setup
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.container.appendChild(this.renderer.domElement);

                // Lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                this.scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
                directionalLight.position.set(2, 2, 2);
                this.scene.add(directionalLight);

                // Globe creation
                this.createGlobe();
            }

            createGlobe() {
                const geometry = new THREE.SphereGeometry(1, 64, 32);

                // Try to load texture, fallback to solid color
                const loader = new THREE.TextureLoader();

                // Create fallback material first
                const fallbackMaterial = new THREE.MeshLambertMaterial({
                    color: 0x6b8e6b
                });

                this.globe = new THREE.Mesh(geometry, fallbackMaterial);
                this.scene.add(this.globe);

                // Try to load the actual texture
                loader.load('./world-map-texture.png',
                    (texture) => {
                        console.log('Texture loaded successfully');
                        const material = new THREE.MeshLambertMaterial({
                            map: texture,
                            transparent: false
                        });
                        this.globe.material = material;
                        this.hideLoading();
                    },
                    (progress) => {
                        console.log('Loading progress:', progress);
                    },
                    (error) => {
                        console.log('Using fallback color - texture not found');
                        this.hideLoading();
                    }
                );
            }

            hideLoading() {
                const loadingElement = document.getElementById('loading');
                if (loadingElement) {
                    loadingElement.style.opacity = '0';
                    setTimeout(() => {
                        loadingElement.style.display = 'none';
                    }, 500);
                }
            }

            animate() {
                this.animationId = requestAnimationFrame(() => this.animate());

                if (this.globe) {
                    // Rotate around Y-axis (360 degrees every 8 seconds)
                    this.globe.rotation.y += 0.005;
                }

                this.renderer.render(this.scene, this.camera);
            }

            setupResize() {
                window.addEventListener('resize', () => {
                    const width = this.container.clientWidth;
                    const height = this.container.clientHeight;

                    this.camera.aspect = width / height;
                    this.camera.updateProjectionMatrix();

                    this.renderer.setSize(width, height);
                    this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                });
            }

            dispose() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }

                if (this.globe) {
                    this.globe.geometry.dispose();
                    this.globe.material.dispose();
                }

                if (this.renderer) {
                    this.renderer.dispose();
                    this.container.removeChild(this.renderer.domElement);
                }
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            const loadingElement = document.getElementById('loading');

            try {
                // Initialize the globe
                const globe = new SpinningGlobe('globe-canvas');
                window.globeInstance = globe;

            } catch (error) {
                console.error('Error initializing globe:', error);
                loadingElement.textContent = 'Error loading globe. Please check the console.';
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (window.globeInstance) {
                window.globeInstance.dispose();
            }
        });
    </script>
</body>
</html>